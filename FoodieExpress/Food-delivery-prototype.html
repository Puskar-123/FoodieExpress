<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Food Delivery Prototype</title>
  <style>
    :root{--accent:#ff6b6b;--muted:#f4f4f6;--card:#fff;--shadow:0 6px 18px rgba(10,10,10,0.08)}
    *{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    body{margin:0;background:linear-gradient(180deg,#fbfbfd, #f6f8ff);min-height:100vh;color:#222}
    header{display:flex;align-items:center;justify-content:space-between;padding:18px 28px}
    h1{margin:0;font-size:18px}
    .btn{background:var(--accent);color:#fff;padding:8px 12px;border-radius:10px;border:0;cursor:pointer}
    .container{display:grid;grid-template-columns:1fr 360px;gap:20px;padding:18px 28px}
    .card{background:var(--card);border-radius:12px;padding:14px;box-shadow:var(--shadow)}

    /* Menu */
    .menu-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px}
    .item{display:flex;gap:10px;align-items:center}
    .thumb{width:72px;height:72px;border-radius:8px;background:linear-gradient(135deg,#ffd0b3,#ffd6d6);display:flex;align-items:center;justify-content:center;font-weight:700}
    .meta{flex:1}
    .meta h3{margin:0;font-size:15px}
    .meta p{margin:4px 0 0;font-size:13px;color:#666}

    /* Cart */
    .cart-list{max-height:320px;overflow:auto;margin-bottom:10px}
    .cart-row{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #f1f1f3}
    .cart-row:last-child{border-bottom:0}

    /* Auth modal */
    .modal{position:fixed;inset:0;background:rgba(5,6,8,0.45);display:flex;align-items:center;justify-content:center}
    .modal-card{width:420px;background:#fff;padding:18px;border-radius:12px}
    .form-row{margin-bottom:10px}
    input[type=text],input[type=password],input[type=email],input[type=number]{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e6ea}

    /* Chatbot */
    .chat{display:flex;flex-direction:column;height:420px}
    .messages{flex:1;overflow:auto;padding:10px}
    .msg{max-width:80%;padding:8px 10px;border-radius:10px;margin:8px 0}
    .msg.user{align-self:flex-end;background:#ffecec}
    .msg.bot{align-self:flex-start;background:#eef3ff}
    .chat-controls{display:flex;gap:8px}
    textarea{width:100%;padding:8px;border-radius:8px;border:1px solid #e6e6ea}

    /* small screens */
    @media (max-width:880px){.container{grid-template-columns:1fr;padding:12px}.cart{order:2}.chat{height:260px}}
  </style>
</head>
<body>
  <header>
    <h1>Foodly — Prototype</h1>
    <div>
      <span id="userBadge"></span>
      <button class="btn" id="authBtn">Login / Signup</button>
    </div>
  </header>

  <main class="container">
    <section>
      <div class="card">
        <h2 style="margin:0 0 12px">Menu</h2>
        <div id="menu" class="menu-grid"></div>
      </div>

      <div class="card" style="margin-top:14px">
        <h2 style="margin:0 0 12px">Your Orders</h2>
        <div class="cart-list" id="cartList"></div>
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div style="font-size:13px;color:#666">Subtotal</div>
            <div id="subtotal">₹0.00</div>
          </div>
          <button class="btn" id="checkoutBtn">Checkout</button>
        </div>
      </div>
    </section>

    <aside>
      <div class="card" style="margin-bottom:14px">
        <h3 style="margin:0 0 10px">Checkout & Tip</h3>
        <div style="margin-bottom:10px">Choose tip:</div>
        <div style="display:flex;gap:8px;margin-bottom:8px">
          <button class="btn tip" data-tip="0.10">10%</button>
          <button class="btn tip" data-tip="0.15">15%</button>
          <button class="btn tip" data-tip="0.20">20%</button>
        </div>
        <div style="display:flex;gap:8px;margin-bottom:12px">
          <input type="number" id="customTip" placeholder="Custom tip (₹)" />
          <button id="applyCustom" class="btn">Apply</button>
        </div>
        <div style="margin-bottom:10px">Total with tip</div>
        <div style="font-size:18px;font-weight:700" id="totalWithTip">₹0.00</div>
        <div style="margin-top:12px;display:flex;gap:8px">
          <button id="placeOrder" class="btn">Place Order</button>
          <button id="clearCart" style="background:#ddd;color:#111;border-radius:10px;padding:8px 12px;border:0">Clear</button>
        </div>
      </div>

      <div class="card chat">
        <h3 style="margin:0 0 10px">Chatbot</h3>
        <div class="messages" id="messages"></div>
        <div class="chat-controls">
          <textarea id="chatInput" rows="2" placeholder="Ask about orders, tips, or menu..."></textarea>
          <button id="sendChat" class="btn">Send</button>
        </div>
      </div>
    </aside>
  </main>

  <!-- Modal (login/signup) -->
  <div id="authModal" class="modal" style="display:none">
    <div class="modal-card">
      <h3 id="authTitle">Login</h3>
      <div class="form-row">
        <input type="email" id="email" placeholder="Email" />
      </div>
      <div class="form-row">
        <input type="password" id="password" placeholder="Password" />
      </div>
      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button id="toggleAuth" style="background:#eee;color:#111;padding:8px;border-radius:8px;border:0">Switch to Signup</button>
        <button id="submitAuth" class="btn">Login</button>
      </div>
      <div style="margin-top:8px;font-size:13px;color:#777">(This prototype stores users in localStorage)</div>
    </div>
  </div>

  <script>
    // ======= Sample Data =======
    const sampleMenu = [
      {id:1,name:'Margherita Pizza',desc:'Classic cheese pizza',price:249},
      {id:2,name:'Veg Burger',desc:'Veg patty with salad',price:149},
      {id:3,name:'Paneer Tikka',desc:'Grilled paneer cubes',price:199},
      {id:4,name:'French Fries',desc:'Crispy salted fries',price:89},
      {id:5,name:'Chocolate Shake',desc:'Rich chocolate milkshake',price:129},
      {id:6,name:'Caesar Salad',desc:'Fresh greens & dressing',price:139}
    ];

    // ======= State =======
    let cart = JSON.parse(localStorage.getItem('fd_cart')||'[]');
    const users = JSON.parse(localStorage.getItem('fd_users')||'{}');
    let currentUser = localStorage.getItem('fd_user') || null;
    let selectedTip = 0;

    // ======= UI refs =======
    const menuEl = document.getElementById('menu');
    const cartList = document.getElementById('cartList');
    const subtotalEl = document.getElementById('subtotal');
    const totalWithTipEl = document.getElementById('totalWithTip');
    const userBadge = document.getElementById('userBadge');
    const authBtn = document.getElementById('authBtn');
    const authModal = document.getElementById('authModal');
    const authTitle = document.getElementById('authTitle');
    const toggleAuth = document.getElementById('toggleAuth');
    const submitAuth = document.getElementById('submitAuth');
    const emailIn = document.getElementById('email');
    const passIn = document.getElementById('password');
    const authBtnMain = document.getElementById('authBtn');

    // Chat
    const messages = document.getElementById('messages');
    const chatInput = document.getElementById('chatInput');
    const sendChat = document.getElementById('sendChat');

    // ======= Renderers =======
    function renderMenu(){
      menuEl.innerHTML = '';
      sampleMenu.forEach(i=>{
        const div = document.createElement('div'); div.className='card item';
        div.innerHTML = `
          <div class="thumb">${i.name.split(' ').slice(0,1)[0].slice(0,2).toUpperCase()}</div>
          <div class="meta">
            <h3>${i.name}</h3>
            <p>${i.desc} • ₹${i.price}</p>
          </div>
          <div>
            <button class="btn" onclick="addToCart(${i.id})">Add</button>
          </div>`;
        menuEl.appendChild(div);
      })
    }

    function renderCart(){
      cartList.innerHTML='';
      if(cart.length===0){cartList.innerHTML='<div style="padding:12px;color:#666">Your cart is empty</div>'}
      cart.forEach(row=>{
        const el = document.createElement('div'); el.className='cart-row';
        el.innerHTML = `<div>${row.name} x ${row.qty}</div><div>₹${row.price*row.qty}</div>`;
        cartList.appendChild(el);
      })
      subtotalEl.textContent = `₹${subtotal().toFixed(2)}`;
      updateTotalWithTip();
      localStorage.setItem('fd_cart', JSON.stringify(cart));
    }

    function subtotal(){return cart.reduce((s,i)=>s + i.price*i.qty,0)}

    function updateTotalWithTip(){
      let sub = subtotal();
      let tipAmt = 0;
      if(selectedTip>0 && selectedTip<1){ tipAmt = sub * selectedTip; }
      else if(selectedTip>=1){ tipAmt = selectedTip; }
      const total = sub + tipAmt;
      totalWithTipEl.textContent = `₹${total.toFixed(2)}`;
    }

    // ======= Actions =======
    window.addToCart = function(id){
      const item = sampleMenu.find(x=>x.id===id);
      const exist = cart.find(x=>x.id===id);
      if(exist) exist.qty++;
      else cart.push({id:item.id,name:item.name,price:item.price,qty:1});
      renderCart();
      botReply(`Added ${item.name} to your cart.`)
    }

    document.getElementById('clearCart').onclick = ()=>{cart=[];renderCart();}

    document.querySelectorAll('.tip').forEach(b=>b.addEventListener('click',e=>{
      selectedTip = Number(e.target.dataset.tip);
      document.getElementById('customTip').value='';
      updateTotalWithTip();
      botReply(`Tip set to ${(selectedTip*100).toFixed(0)}%`)
    }))

    document.getElementById('applyCustom').onclick = ()=>{
      const v = Number(document.getElementById('customTip').value || 0);
      if(isNaN(v) || v<0){alert('Enter a valid tip');return}
      selectedTip = v; // absolute rupee amount
      updateTotalWithTip();
      botReply(`Custom tip applied: ₹${v.toFixed(2)}`)
    }

    document.getElementById('placeOrder').onclick = ()=>{
      if(!currentUser){openAuth(); botReply('Please login to place an order.'); return}
      if(cart.length===0){botReply('Your cart is empty. Add items first.');return}
      const order = {id:'ORD'+Date.now(),user:currentUser,items:cart,subtotal:subtotal(),tip:selectedTip,placedAt:new Date().toISOString()};
      // save to orders in localStorage
      const orders = JSON.parse(localStorage.getItem('fd_orders')||'[]');
      orders.push(order);
      localStorage.setItem('fd_orders', JSON.stringify(orders));
      cart = [];
      renderCart();
      botReply(`Order ${order.id} placed! Total ₹${(order.subtotal + (order.tip<1?order.subtotal*order.tip:order.tip)).toFixed(2)}.`)
    }

    // ======= Auth flows =======
    authBtn.addEventListener('click',openAuth);
    function openAuth(){authModal.style.display='flex';authMode='login';updateAuthUI();}
    let authMode='login';
    toggleAuth.addEventListener('click',()=>{authMode = authMode==='login'?'signup':'login'; updateAuthUI()});

    function updateAuthUI(){authTitle.textContent = authMode==='login'?'Login':'Signup'; submitAuth.textContent = authMode==='login'?'Login':'Create account'; toggleAuth.textContent = authMode==='login'?'Switch to Signup':'Switch to Login'}

    submitAuth.addEventListener('click',()=>{
      const email = emailIn.value.trim().toLowerCase(); const pass = passIn.value;
      if(!email || !pass){alert('Provide email & password');return}
      const usersObj = JSON.parse(localStorage.getItem('fd_users')||'{}');
      if(authMode==='signup'){
        if(usersObj[email]){alert('User exists, please login');return}
        usersObj[email] = {email,password:pass};
        localStorage.setItem('fd_users', JSON.stringify(usersObj));
        currentUser = email; localStorage.setItem('fd_user', currentUser); authModal.style.display='none'; updateUserUI(); botReply('Signup successful!')
      } else {
        if(!usersObj[email] || usersObj[email].password !== pass){alert('Invalid credentials');return}
        currentUser = email; localStorage.setItem('fd_user', currentUser); authModal.style.display='none'; updateUserUI(); botReply('Logged in!')
      }
    })

    // close modal when clicking the overlay
    authModal.addEventListener('click',e=>{if(e.target===authModal) authModal.style.display='none'})

    function updateUserUI(){
      userBadge.textContent = currentUser? `Hello, ${currentUser.split('@')[0]}` : '';
      authBtn.textContent = currentUser? 'Logout' : 'Login / Signup';
      if(currentUser){authBtn.onclick = ()=>{localStorage.removeItem('fd_user'); currentUser=null; updateUserUI(); botReply('Logged out.')}}
      else {authBtn.onclick = openAuth}
    }

    // ======= Chatbot (simple rule-based) =======
    function botReply(text){
      const el = document.createElement('div'); el.className='msg bot'; el.textContent = text; messages.appendChild(el); messages.scrollTop = messages.scrollHeight;
    }

    function userMsg(text){
      const el = document.createElement('div'); el.className='msg user'; el.textContent = text; messages.appendChild(el); messages.scrollTop = messages.scrollHeight;
      // generate bot response
      setTimeout(()=>{
        const resp = handleChat(text);
        botReply(resp);
      },350)
    }

    function handleChat(input){
      const q = input.toLowerCase();
      if(/(hi|hello|hey)/.test(q)) return 'Hello! I can help with menu, orders, tips or account. Try: "show menu", "my orders", "how to tip"';
      if(/menu/.test(q)) return sampleMenu.map(i=>`${i.name} — ₹${i.price}`).join('\n');
      if(/orders|my order|order status/.test(q)){
        if(!currentUser) return 'Please login to see your orders.';
        const orders = JSON.parse(localStorage.getItem('fd_orders')||'[]').filter(o=>o.user===currentUser);
        if(orders.length===0) return 'You have no orders yet.';
        return orders.map(o=>`${o.id} • ₹${(o.subtotal + (o.tip<1?o.subtotal*o.tip:o.tip)).toFixed(2)} • ${new Date(o.placedAt).toLocaleString()}`).join('\n');
      }
      if(/tip|how to tip|tips/.test(q)) return 'You can pick 10%, 15%, 20% or enter a custom rupee amount in checkout. Tip is applied to subtotal.';
      if(/add .* to cart|add .* cart/.test(q)){
        // naive item add
        for(const item of sampleMenu){ if(q.includes(item.name.split(' ')[0].toLowerCase())){ addToCart(item.id); return `Added ${item.name} to cart.` }}
        return 'Tell me the item name to add (e.g. add pizza to cart)';
      }
      if(/help|support/.test(q)) return 'Support email: support@foodly.example — or ask me about menu, orders, or tips.';
      return "Sorry, I didn't understand. Try: 'menu', 'my orders', 'how to tip', or 'add pizza to cart'.";
    }

    sendChat.addEventListener('click',()=>{const txt = chatInput.value.trim(); if(!txt) return; userMsg(txt); chatInput.value='';});
    chatInput.addEventListener('keydown',e=>{if(e.key==='Enter' && !e.shiftKey){e.preventDefault(); sendChat.click()}})

    // init
    renderMenu(); renderCart(); updateUserUI(); botReply('Hi! I am Foodly bot — ask me anything about the menu, orders or tips.')
  </script>
</body>
</html>
